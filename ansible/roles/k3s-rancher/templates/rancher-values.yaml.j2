# Rancher Helm Chart Values
# Generated by Ansible for {{ k3s_cluster_name | default('homelab-k3s') }}

# Hostname for Rancher UI
hostname: {{ rancher_hostname }}

# Replica count for high availability
replicas: {{ rancher_replicas }}

# Bootstrap password for initial admin access
bootstrapPassword: {{ rancher_bootstrap_password }}

# ============================================
# TLS/Ingress Configuration
# ============================================
ingress:
  tls:
    # Source of TLS certificates: rancher, letsEncrypt, secret
    source: {{ rancher_ingress_tls_source }}
{% if rancher_ingress_class %}
  ingressClassName: {{ rancher_ingress_class }}
{% endif %}
{% if rancher_ingress_annotations %}
  extraAnnotations:
{% for key, value in rancher_ingress_annotations.items() %}
    {{ key }}: "{{ value }}"
{% endfor %}
{% endif %}

{% if rancher_ingress_tls_source == "letsEncrypt" %}
# Let's Encrypt configuration
letsEncrypt:
  email: {{ rancher_letsencrypt_email }}
  environment: {{ rancher_letsencrypt_environment }}
  ingress:
    class: {{ rancher_letsencrypt_ingress_class }}
{% endif %}

{% if rancher_ingress_tls_source == "secret" %}
# Custom TLS secret
privateCA: true
{% endif %}

# ============================================
# Resource Configuration
# ============================================
resources:
  requests:
    cpu: {{ rancher_resources_requests_cpu }}
    memory: {{ rancher_resources_requests_memory }}
  limits:
    cpu: {{ rancher_resources_limits_cpu }}
    memory: {{ rancher_resources_limits_memory }}

# ============================================
# Anti-Affinity Configuration
# ============================================
antiAffinity: {{ rancher_anti_affinity }}

# ============================================
# Certificate Management
# ============================================
{% if rancher_add_local_ca == "true" and rancher_private_ca_secret_name %}
privateCA: true
additionalTrustedCAs: true
{% endif %}

# ============================================
# Proxy Configuration
# ============================================
{% if rancher_proxy_http or rancher_proxy_https %}
proxy:
{% if rancher_proxy_http %}
  http: {{ rancher_proxy_http }}
{% endif %}
{% if rancher_proxy_https %}
  https: {{ rancher_proxy_https }}
{% endif %}
{% if rancher_no_proxy %}
  noProxy: {{ rancher_no_proxy }}
{% endif %}
{% endif %}

# ============================================
# PSP Configuration
# ============================================
global:
  cattle:
    psp:
      enabled: {{ rancher_global_psp_enabled | lower }}

# ============================================
# Additional Environment Variables
# ============================================
{% if rancher_extra_env %}
extraEnv:
{% for env in rancher_extra_env %}
  - name: {{ env.name }}
    value: "{{ env.value }}"
{% endfor %}
{% endif %}

# ============================================
# Health Probe Configuration
# ============================================
# Increase startup probe timeout for slower systems
startupProbe:
  failureThreshold: 30  # Allow 5 minutes for startup (30 * 10s)
  periodSeconds: 10
  timeoutSeconds: 5

livenessProbe:
  failureThreshold: 3
  periodSeconds: 10
  timeoutSeconds: 5

readinessProbe:
  failureThreshold: 3
  periodSeconds: 10
  timeoutSeconds: 5

# ============================================
# Additional Helm Values
# ============================================
{% if rancher_additional_helm_values %}
{{ rancher_additional_helm_values | to_nice_yaml(indent=2) }}
{% endif %}
