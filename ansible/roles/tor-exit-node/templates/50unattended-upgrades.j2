// Automatic Security Updates Configuration for Tor Exit Node
// Generated by Ansible on {{ ansible_date_time.iso8601 }}

Unattended-Upgrade::Allowed-Origins {
    "${distro_id}:${distro_codename}";
    "${distro_id}:${distro_codename}-security";
    "${distro_id}ESMApps:${distro_codename}-apps-security";
    "${distro_id}ESM:${distro_codename}-infra-security";
    // Tor Project repository updates
    "TorProject:${distro_codename}";
};

// List of packages to not automatically upgrade
Unattended-Upgrade::Package-Blacklist {
    // None currently
};

// Automatically upgrade all packages
Unattended-Upgrade::DevRelease "false";

// Automatically reboot if required
Unattended-Upgrade::Automatic-Reboot "true";

// Reboot time (02:00 AM)
Unattended-Upgrade::Automatic-Reboot-Time "{{ tor_auto_reboot_time }}";

// Automatically reboot even if users are logged in
Unattended-Upgrade::Automatic-Reboot-WithUsers "false";

// Remove unused automatically installed kernel-related packages
Unattended-Upgrade::Remove-Unused-Kernel-Packages "true";

// Remove unused dependencies
Unattended-Upgrade::Remove-Unused-Dependencies "true";

// Automatically clean packages
Unattended-Upgrade::Remove-New-Unused-Dependencies "true";

// Email notification
{% if tor_alert_email %}
Unattended-Upgrade::Mail "{{ tor_alert_email }}";
Unattended-Upgrade::MailReport "only-on-error";
{% else %}
// Unattended-Upgrade::Mail "root";
Unattended-Upgrade::MailReport "on-change";
{% endif %}

// Allow automatic upgrades to be skipped if system is on battery
Unattended-Upgrade::Skip-Updates-On-Metered-Connections "false";

// Syslog facility
Unattended-Upgrade::SyslogEnable "true";
Unattended-Upgrade::SyslogFacility "daemon";

// Update package lists
APT::Periodic::Update-Package-Lists "1";

// Download upgradeable packages
APT::Periodic::Download-Upgradeable-Packages "1";

// Automatically upgrade packages
APT::Periodic::Unattended-Upgrade "1";

// Clean downloaded packages
APT::Periodic::AutocleanInterval "7";
